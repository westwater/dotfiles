#!/usr/bin/env zsh
# My run commands

# global variables
EDITOR='micro'
# export JAVA_OPTS="-Dfile.encoding=UTF8 -Xms1G -Xmx4G -XX:ReservedCodeCacheSize=250M -XX:+TieredCompilation -XX:+UseParallelGC -XX:MaxInlineLevel=18"
export SDKMAN_DIR="$HOME/.sdkman"
export NODE_PATH=/usr/local/lib/node_modules

# function path_remove {
#   # Delete path by parts so we can never accidentally remove sub paths
#   PATH=${PATH//":$1:"/":"} # delete any instances in the middle
#   PATH=${PATH/#"$1:"/} # delete any instance at the beginning
#   PATH=${PATH/%":$1"/} # delete any instance in the at the end
# }
#
# path_remove "/usr/bin/java"

# awsp
# https://github.com/johnnyopao/awsp
# npm install -g awsp
alias awsp="source _awsp"

# marker
[[ -s "$HOME/.local/share/marker/marker.sh" ]] && source "$HOME/.local/share/marker/marker.sh"

# bat
export BAT_THEME="1337"

# rbenv
if type "rbenv" > /dev/null; then
	path_prepend "$HOME/.rbenv/bin"
	eval "$(rbenv init -)"
fi

# uv (python version/package manager)
# uv replaces pyenv, pip, pipx, and virtualenv
# list versions    - uv python list
# install version  - uv python install 3.12
# install tool     - uv tool install <package>
# run in project   - uv run python script.py
#
# Python symlinks are in ~/.local/bin/ (created by uv python install)
# Tools are in ~/.local/share/uv/tools/ with symlinks in ~/.local/bin/
path_prepend "$HOME/.local/bin"

# krew
path_prepend "${KREW_ROOT:-$HOME/.krew}/bin"

# kubectl completion loaded in .zshrc after compinit

# kitty
bindkey "\e[1;3D"  backward-word # ⌥←
bindkey "\e[1;3C"  forward-word # ⌥→
bindkey  "\e[1;9D" beginning-of-line # ⌘→
bindkey  "\e[1;9C" end-of-line # ⌘←

# nvm
export NVM_DIR="$HOME/.nvm"
if [ ! -d "$NVM_DIR" ]; then
  echo "Installing nvm..."
  curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash
fi
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"

# service-manager 
export WORKSPACE="$HOME/work/hmrc"

# sdkman
# check versions  - sdk list java
# install version - sdk install java 19.0.1-amzn
[[ -s "$HOME/.sdkman/bin/sdkman-init.sh" ]] && source "$HOME/.sdkman/bin/sdkman-init.sh"

# functions

# greps the shell commands loaded on startup to find where
# a specific environment variable is loaded from
# usage: find_var some_env_variable
#
# todo: fix needed
#   - need to open new tab after use
#     or
#   - need to execute 'exit' after use
find_var() { zsh -xl 2>&1 | grep $1 ; }

# files to load on startup
filesToLoad=(
  # dotfiles/.animate_prompt
  dotfiles/scripts/colours.sh
  dotfiles/.aliases
  dotfiles/.extensions
  # dotfiles/.pl9k_theme  # replaced by .p10k.zsh (sourced at end of .zshrc)
  vault/secrets
)

for file in "${filesToLoad[@]}"; do
  [[ -s "$HOME/$file" ]] && source "$HOME/$file"
done

# check for p10k updates (background, once per day)
[[ -s "$HOME/dotfiles/scripts/check-p10k-updates.sh" ]] && source "$HOME/dotfiles/scripts/check-p10k-updates.sh"
